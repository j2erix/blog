# 踩坑记
***
顾名思义，仅以这篇文章记录编程过程中踩过的坑。

### 在webpack中使用fetch API
背景：学习redux的文档过程中用到了`isomorphic-fetch`这个包。不仅不work，还导致client报错`Uncaught TypeError: inherits is not a function`。

原因：webpack中使用es6-promise或者babel-polyfill需要特殊的做法。

解决：参考文章[http://mts.io/2015/04/08/webpack-shims-polyfills/](http://mts.io/2015/04/08/webpack-shims-polyfills/)

### Mac OSX查看端口占用，关闭进程
查看端口占用：lsof -i:3000
关机进程： kill -9 pid

### 引入isomorphic-fetch后报错
在webpack打包的项目中引入`isomorphic-fetch`的时候，报出如下错误：

```
ERROR in ./~/isomorphic-fetch/~/node-fetch/~/encoding/~/iconv-lite/encodings/dbcs-data.js
Module not found: Error: Cannot resolve module 'json' in /Users/zhengjin/Dev/demo/turris-init/node_modules/isomorphic-fetch/node_modules/node-fetch/node_modules/encoding/node_modules/iconv-lite/encodings
 @ ./~/isomorphic-fetch/~/node-fetch/~/encoding/~/iconv-lite/encodings/dbcs-data.js 44:35-68
```
解决方法：`npm install --save json-loader`

### thunkMiddleWare没有处理异步reducer
因为返回的是一个`function`，并没有执行`dispatch`。
有两个解决方法:

1. 手动执行`dispatch()`
2. 在`connect()`的第二个参数中添加这个异步`reducer`：
如`connect(appSelector, {...actionTypes}, App)`

### 通过异步reducer获取cluster，结果嵌套问题
因为在如下代码中：

```
function entities(state = {cluster: {}}, action) {
    if (action.response && action.response.entities) {
        return merge({}, state, action.response.entities);
    }

    return state;
}
```
`merge`的时候错把`action.response.entities`写成`action.response, entities`，从而导致selector在比对的时候有问题，产生了嵌套。

### 如何把cluster传到indexPage中

`example/real-world`中，是在`mapStateToProps`中对`user`和`users`做了映射。

所以，`wizard`中需要对`cluster`和`clusters`做一个映射。

### connect的时候，selector不起作用

执行如下命令的时候，selector没有注入到App中：

```
export default connect(appSelector, {loadCluster})(App);
```

原因是`appSelector`没有正确`import`，需要根据ES6 Module正确的模块语法，参考：[http://es6.ruanyifeng.com/#docs/module](http://es6.ruanyifeng.com/#docs/module)